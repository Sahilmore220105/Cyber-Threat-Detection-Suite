import pandas as pd
from sklearn.ensemble import RandomForestClassifier
import joblib
import os

DATA_PATH = "data/SOMLAP DATASET.csv"
MODEL_PATH = "models/malware_model.pkl"

def train():
    df = pd.read_csv(DATA_PATH)
    # Select common PE features available in the SOMLAP dataset
    features = ['blp', 'Fp', 'Rn', 'mach', 'nsec', 'tds', 
                'codesize', 'initdatsize', 'uninitdatsize']

    X = df[features]
    y = df['class'] # 1 for Malware, 0 for Benign

    model = RandomForestClassifier(n_estimators=100)
    model.fit(X, y)

    os.makedirs('models', exist_ok=True)
    joblib.dump(model, MODEL_PATH)
    print("Malware model trained and saved.")

if __name__ == "__main__":
    train()